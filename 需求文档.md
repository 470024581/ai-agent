# Smart AI Assistant 需求文档

## 1. 项目概述

### 1.1 项目背景
Smart AI Assistant 是一个企业级智能数据分析平台，结合了自然语言处理与先进的工作流编排技术。该系统通过 React 前端界面与强大的 FastAPI 后端集成，具备 LangGraph 工作流编排、多 LLM 支持和实时数据处理能力。

**项目定位**: 面向企业用户的智能数据分析助手，降低数据分析门槛，提升业务决策效率。

**核心价值**: 
- 将复杂的数据库查询转换为自然语言交互
- 提供多模态数据源统一分析能力
- 实现 AI 驱动的智能洞察和建议

### 1.2 项目目标

#### 1.2.1 主要目标
- **智能化**: 提供基于自然语言的智能数据查询与分析
- **统一化**: 支持多种数据源类型的统一管理和分析
- **实时化**: 实现实时工作流执行监控和状态反馈
- **可扩展**: 构建可扩展的企业级 AI 应用架构

#### 1.2.2 业务目标
- 提升数据分析效率 80% 以上
- 降低非技术用户的数据分析门槛
- 支持快速业务决策和洞察发现
- 建立标准化的数据分析工作流

#### 1.2.3 技术目标
- 构建高性能、高可用的系统架构
- 实现模块化、可插拔的功能设计
- 支持多环境部署和水平扩展
- 建立完善的监控和运维体系

### 1.3 技术架构

#### 1.3.1 整体架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端层        │    │   后端层        │    │   数据层        │
│                 │    │                 │    │                 │
│ React 18        │◄──►│ FastAPI         │◄──►│ SQLite/PostgreSQL│
│ Redux Toolkit   │    │ LangGraph       │    │ FAISS Vector    │
│ Tailwind CSS    │    │ SQLAlchemy      │    │ File Storage    │
│ Radix UI        │    │ WebSocket       │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   AI 服务层     │    │   工作流引擎    │    │   外部集成      │
│                 │    │                 │    │                 │
│ OpenAI GPT      │    │ LangGraph       │    │ REST API        │
│ OpenRouter      │    │ Workflow        │    │ WebSocket       │
│ Ollama          │    │ Orchestration   │    │ File Upload     │
│ HuggingFace     │    │ State Management│    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

#### 1.3.2 技术栈详情
- **前端技术栈**:
  - React 18: 现代化 UI 框架，支持并发特性
  - Redux Toolkit: 状态管理，支持 RTK Query
  - Tailwind CSS: 原子化 CSS 框架
  - Radix UI: 无障碍组件库
  - i18next: 国际化支持
  - Recharts: 数据可视化
  - Vite: 快速构建工具

- **后端技术栈**:
  - FastAPI: 高性能异步 Web 框架
  - LangGraph: AI 工作流编排引擎
  - SQLAlchemy: ORM 数据库操作
  - Pydantic: 数据验证和序列化
  - WebSocket: 实时通信
  - Celery: 异步任务队列（可选）

- **AI 服务集成**:
  - OpenAI GPT-4/3.5: 主要语言模型
  - OpenRouter: 多模型 API 网关
  - Ollama: 本地模型部署
  - HuggingFace: 嵌入模型和开源模型

- **数据存储**:
  - SQLite: 开发环境数据库
  - PostgreSQL: 生产环境数据库
  - FAISS: 向量相似性搜索
  - 文件系统: 文档和媒体文件存储

## 2. 核心功能需求

### 2.1 智能问答系统

#### 2.1.1 自然语言查询
**功能描述**: 用户可以使用自然语言进行数据查询，系统自动理解用户意图并生成相应的分析结果。

**核心特性**:
- **多语言支持**: 支持中文、英文查询，自动识别语言类型
- **智能理解**: 基于 LLM 的意图识别和实体提取
- **上下文记忆**: 支持多轮对话，保持上下文连贯性
- **查询优化**: 自动优化查询语句，提高查询效率

**示例查询场景**:
- **销售分析**: "本月销售额多少？"、"哪个产品销量最好？"
- **库存管理**: "库存低于50的产品有哪些？"、"哪些产品需要补货？"
- **趋势分析**: "过去7天的销售趋势如何？"、"环比增长情况？"
- **客户分析**: "VIP客户有哪些？"、"客户购买行为分析？"
- **财务分析**: "利润率最高的产品类别？"、"成本分析报告？"

**技术实现**:
- 使用 LangGraph 工作流引擎处理复杂查询
- 集成多个 LLM 提供商确保服务稳定性
- 实现查询缓存机制提升响应速度
- 支持查询结果的质量评估和自动重试

#### 2.1.2 多数据源支持
**功能描述**: 系统支持多种类型的数据源，能够统一管理和分析不同类型的数据。

**数据源类型**:
- **知识库 (Knowledge Base)**:
  - 支持 PDF、Word、TXT 等文档格式
  - 基于 FAISS 的向量相似性搜索
  - 支持文档内容的语义理解和问答
  - 自动文档分块和索引建立

- **SQL 表 (Structured Data)**:
  - 支持关系型数据库查询
  - 自动 SQL 生成和优化
  - 支持复杂的数据关联查询
  - 提供数据表结构自动发现

- **混合模式 (Hybrid)**:
  - 结合结构化数据和非结构化文档
  - 支持跨数据源的关联分析
  - 提供综合性的分析结果
  - 智能选择最适合的数据源

**数据源管理**:
- 动态数据源配置和切换
- 数据源健康状态监控
- 数据源权限和安全控制
- 数据源性能优化和缓存

#### 2.1.3 智能路由
**功能描述**: 根据查询类型、数据源状态和用户意图，自动选择最适合的处理路径。

**路由策略**:
- **SQL 查询路径**:
  - 适用于结构化数据查询
  - 自动生成和优化 SQL 语句
  - 支持复杂的数据聚合和分析
  - 提供查询性能监控

- **RAG 路径**:
  - 适用于文档检索和问答
  - 基于语义相似性的文档搜索
  - 支持多文档综合分析和总结
  - 提供引用来源和可信度评估

- **混合路径**:
  - 结合多种数据源的综合分析
  - 支持跨模态的数据关联
  - 提供更全面的分析结果
  - 智能选择最优的数据组合

**路由优化**:
- 基于历史查询性能的路由选择
- 动态调整路由策略
- 支持人工干预和路由规则定制
- 提供路由决策的可解释性

### 2.2 数据源管理

#### 2.2.1 数据源创建与管理
**功能描述**: 提供完整的数据源生命周期管理，支持创建、配置、监控和管理多种类型的数据源。

**数据源类型**:
- **默认数据源**:
  - 系统预置的示例销售数据
  - 包含产品、订单、客户等基础数据表
  - 用于演示和测试系统功能
  - 支持数据重置和更新

- **混合数据源**:
  - 支持文件上传和 SQL 查询的混合模式
  - 可配置数据源名称、描述和类型
  - 支持多种文件格式的数据导入
  - 提供数据源模板和快速配置

**管理功能**:
- **创建数据源**:
  - 向导式数据源创建流程
  - 数据源类型自动检测和推荐
  - 数据源配置验证和测试
  - 支持数据源模板和预设配置

- **激活/停用数据源**:
  - 一键切换当前活跃数据源
  - 数据源状态实时监控
  - 支持数据源批量操作
  - 提供数据源使用统计

- **删除数据源**:
  - 安全删除确认机制
  - 关联数据清理和备份
  - 支持数据源恢复功能
  - 提供删除影响评估

- **查看数据源详情**:
  - 数据源基本信息展示
  - 数据源使用统计和性能指标
  - 数据源健康状态监控
  - 支持数据源配置导出和导入

#### 2.2.2 文件管理
**功能描述**: 提供完整的文件生命周期管理，支持文件上传、处理、监控和管理。

**支持文件类型**:
- **CSV 文件**:
  - 用于 SQL 表数据源
  - 支持自动列类型检测
  - 提供数据预览和验证
  - 支持大文件分块上传

- **PDF 文件**:
  - 用于知识库数据源
  - 支持文本提取和OCR识别
  - 自动文档分块和索引
  - 支持扫描版PDF处理

- **Word 文档**:
  - 支持 .docx 格式
  - 保留文档格式和结构
  - 支持表格和图片提取
  - 提供文档内容预览

- **Excel 文件**:
  - 支持 .xlsx 格式
  - 多工作表处理
  - 自动数据类型识别
  - 支持复杂表格结构

- **文本文件**:
  - 支持 .txt 格式
  - 自动编码检测
  - 支持多种文本格式
  - 提供文本内容预览

**文件操作**:
- **文件上传**:
  - 拖拽上传和点击上传
  - 支持批量文件上传
  - 文件大小限制（最大 100MB）
  - 上传进度实时显示

- **文件处理状态监控**:
  - 实时处理状态更新
  - 处理进度百分比显示
  - 错误信息详细展示
  - 支持处理任务取消

- **文件删除**:
  - 安全删除确认
  - 关联数据清理
  - 支持批量删除
  - 删除操作日志记录

- **处理进度实时更新**:
  - WebSocket 实时推送
  - 处理阶段详细展示
  - 预估完成时间
  - 支持处理任务暂停和恢复

#### 2.2.3 示例数据
**功能描述**: 提供丰富的示例数据文件，帮助用户快速上手和测试系统功能。

**数据内容**:
- **时间范围**: 2021-2025 年示例销售数据
- **数据规模**: 每年包含数万条销售记录
- **数据字段**: 产品ID、客户ID、销售日期、销售金额、数量等
- **数据质量**: 经过清洗和验证的高质量示例数据

**数据特点**:
- **真实性**: 基于真实业务场景的模拟数据
- **完整性**: 包含完整的业务数据链路
- **多样性**: 涵盖不同行业和业务场景
- **可扩展**: 支持数据扩展和自定义

**用途场景**:
- **功能演示**: 展示系统各项功能特性
- **用户培训**: 帮助新用户快速上手
- **性能测试**: 测试系统处理能力
- **功能验证**: 验证新功能的正确性

**数据管理**:
- 支持示例数据下载
- 提供数据格式说明
- 支持数据定制和扩展
- 提供数据使用指南

### 2.3 实时工作流监控

#### 2.3.1 WebSocket 通信
**功能描述**: 基于 WebSocket 技术实现工作流执行状态的实时监控和通信。

**核心特性**:
- **实时性**: 毫秒级的状态更新和事件推送
- **可靠性**: 连接断开自动重连和消息重发
- **扩展性**: 支持多客户端并发连接
- **安全性**: 连接认证和消息加密

**监控内容**:
- **工作流节点执行状态**:
  - 节点开始、进行中、完成、失败状态
  - 节点执行时间和性能指标
  - 节点输入输出数据预览
  - 节点错误信息和调试信息

- **处理进度更新**:
  - 整体工作流执行进度
  - 各阶段完成百分比
  - 预估剩余时间
  - 资源使用情况监控

- **错误信息推送**:
  - 实时错误检测和报告
  - 错误分类和严重程度
  - 错误恢复建议
  - 错误历史记录

- **完成通知**:
  - 工作流成功完成通知
  - 结果摘要和关键指标
  - 后续操作建议
  - 结果数据下载链接

**技术实现**:
- 使用 FastAPI WebSocket 支持
- 实现连接池和消息队列
- 支持消息持久化和重发
- 提供客户端 SDK 和示例

#### 2.3.2 工作流可视化
**功能描述**: 提供直观的工作流执行过程可视化展示，帮助用户理解系统处理流程。

**展示内容**:
- **节点执行状态**:
  - 节点状态颜色编码（绿色-成功、黄色-进行中、红色-失败、灰色-等待）
  - 节点执行时间轴展示
  - 节点依赖关系图
  - 节点性能指标统计

- **数据流转过程**:
  - 数据在节点间的流转路径
  - 数据格式和结构变化
  - 数据量大小和传输速度
  - 数据质量指标

- **执行时间统计**:
  - 各节点执行时间对比
  - 整体工作流执行时间
  - 性能瓶颈识别
  - 历史执行时间趋势

- **错误诊断信息**:
  - 错误发生位置和原因
  - 错误堆栈和调试信息
  - 错误影响范围分析
  - 错误修复建议

**可视化特性**:
- **交互式图表**: 支持缩放、拖拽、点击查看详情
- **实时更新**: 图表数据实时刷新
- **多视图支持**: 支持时间轴、流程图、统计图等多种视图
- **导出功能**: 支持图表导出为图片或PDF

### 2.4 数据可视化

#### 2.4.1 图表生成
**功能描述**: 根据查询结果和数据类型，自动选择最适合的图表类型并生成可视化图表。

**图表类型**:
- **柱状图**:
  - 适用于分类数据对比
  - 支持水平、垂直、堆叠等多种样式
  - 支持多系列数据展示
  - 提供数据标签和数值显示

- **折线图**:
  - 适用于时间序列和趋势分析
  - 支持多条线对比
  - 支持数据点标记
  - 提供趋势线和预测线

- **饼图**:
  - 适用于比例和占比展示
  - 支持环形图和半圆图
  - 支持数据标签和百分比
  - 提供图例和颜色自定义

- **散点图**:
  - 适用于相关性分析
  - 支持气泡大小表示第三维度
  - 支持趋势线拟合
  - 提供数据点详情展示

- **其他图表**:
  - 面积图：展示数据累积效果
  - 雷达图：多维度数据对比
  - 热力图：数据密度和分布
  - 树状图：层次结构数据

**智能图表选择**:
- 基于数据特征自动推荐图表类型
- 支持用户手动选择图表类型
- 提供图表类型说明和适用场景
- 支持图表参数自定义配置

#### 2.4.2 交互式仪表板
**功能描述**: 提供功能丰富的交互式数据展示界面，支持多维度数据分析和自定义视图。

**特性**:
- **响应式设计**:
  - 自适应不同屏幕尺寸
  - 支持移动端和桌面端
  - 提供多种布局模板
  - 支持拖拽调整组件大小

- **实时数据更新**:
  - 数据变化实时反映
  - 支持定时刷新设置
  - 提供数据更新通知
  - 支持手动刷新控制

- **多维度数据展示**:
  - 支持多图表组合展示
  - 提供数据钻取功能
  - 支持数据筛选和排序
  - 提供数据对比分析

- **自定义视图**:
  - 支持仪表板布局自定义
  - 提供主题和样式选择
  - 支持组件添加和删除
  - 提供视图保存和分享

**交互功能**:
- **数据钻取**: 点击图表元素查看详细数据
- **数据筛选**: 通过交互控件筛选数据
- **数据对比**: 选择多个数据系列进行对比
- **数据导出**: 支持图表和数据导出

### 2.5 用户界面

#### 2.5.1 多语言支持
**功能描述**: 提供完整的多语言支持，确保不同语言用户都能获得良好的使用体验。

**支持语言**:
- **中文（简体）**: 主要支持语言
- **英文**: 国际化支持语言
- **扩展支持**: 预留其他语言扩展接口

**国际化功能**:
- **界面文本翻译**:
  - 所有界面元素支持多语言
  - 动态语言切换
  - 翻译质量保证
  - 支持自定义翻译

- **日期时间格式本地化**:
  - 根据语言自动调整日期格式
  - 支持时区设置
  - 提供多种日期显示选项
  - 支持相对时间显示

- **数字格式本地化**:
  - 数字分隔符和精度设置
  - 货币符号和格式
  - 百分比和小数格式
  - 支持科学计数法

- **文化适配**:
  - 颜色和图标文化适配
  - 布局方向支持（RTL）
  - 字体和排版优化
  - 文化敏感内容处理

#### 2.5.2 主题支持
**功能描述**: 提供多种主题选择，满足不同用户的视觉偏好和使用环境需求。

**主题特性**:
- **深色模式**:
  - 适合低光环境使用
  - 减少眼部疲劳
  - 提供多种深色主题变体
  - 支持自定义深色配色

- **浅色模式**:
  - 适合明亮环境使用
  - 提供清晰的视觉对比
  - 支持多种浅色主题变体
  - 支持自定义浅色配色

- **自动主题切换**:
  - 根据系统设置自动切换
  - 根据时间自动调整
  - 根据环境光线检测
  - 支持手动覆盖设置

- **自定义主题**:
  - 支持用户自定义配色方案
  - 提供主题编辑器
  - 支持主题导入导出
  - 提供主题分享功能

#### 2.5.3 响应式设计
**功能描述**: 确保系统在不同设备和屏幕尺寸上都能提供良好的用户体验。

**适配范围**:
- **桌面端**:
  - 支持 1920x1080 及以上分辨率
  - 提供多窗口和多标签支持
  - 支持键盘快捷键操作
  - 提供丰富的交互功能

- **平板端**:
  - 支持 768x1024 及以上分辨率
  - 优化触摸操作体验
  - 提供手势导航支持
  - 适配横屏和竖屏模式

- **移动端**:
  - 支持 375x667 及以上分辨率
  - 提供移动端专用界面
  - 优化触摸操作和滑动
  - 支持移动端特有功能

**响应式特性**:
- **弹性布局**: 使用 Flexbox 和 Grid 布局
- **媒体查询**: 基于屏幕尺寸的样式调整
- **图片优化**: 根据设备提供合适尺寸的图片
- **字体缩放**: 根据设备调整字体大小

## 3. 技术需求

### 3.1 前端技术栈
- **框架**: React 18
- **状态管理**: Redux Toolkit
- **样式**: Tailwind CSS + Radix UI
- **路由**: React Router 6
- **国际化**: i18next
- **图表**: Recharts
- **构建工具**: Vite

### 3.2 后端技术栈
- **框架**: FastAPI
- **工作流**: LangGraph
- **数据库**: SQLAlchemy + SQLite/PostgreSQL
- **向量存储**: FAISS
- **文档处理**: 支持 PDF、Word、Excel、TXT
- **实时通信**: WebSocket

### 3.3 AI 服务集成
- **LLM 提供商**:
  - OpenAI GPT 系列
  - OpenRouter 多模型支持
  - Ollama 本地模型
- **嵌入模型**: HuggingFace multilingual-e5-small
- **工作流引擎**: LangGraph

### 3.4 部署要求
- **容器化**: Docker 支持
- **环境配置**: 支持多环境部署
- **数据持久化**: 数据库和文件存储
- **监控**: 日志记录和错误追踪

## 3. 技术需求

### 3.1 前端技术栈
**核心框架**:
- **React 18**: 现代化 UI 框架，支持并发特性、Suspense、错误边界等新特性
- **TypeScript**: 提供类型安全和更好的开发体验
- **Vite**: 快速构建工具，支持热重载和模块联邦

**状态管理**:
- **Redux Toolkit**: 现代化状态管理，包含 RTK Query 用于 API 状态管理
- **React Query**: 服务端状态管理和缓存
- **Zustand**: 轻量级状态管理（可选）

**UI 组件库**:
- **Tailwind CSS**: 原子化 CSS 框架，提供快速样式开发
- **Radix UI**: 无障碍组件库，提供高质量的基础组件
- **Headless UI**: 无样式组件库，支持自定义样式
- **Framer Motion**: 动画库，提供流畅的交互动画

**路由和导航**:
- **React Router 6**: 客户端路由，支持嵌套路由和懒加载
- **React Hook Form**: 表单管理和验证
- **React Query**: API 状态管理和缓存

**数据可视化**:
- **Recharts**: 基于 React 的图表库
- **D3.js**: 底层数据可视化库（高级定制）
- **Chart.js**: 轻量级图表库（备用选择）

**国际化**:
- **i18next**: 国际化框架，支持动态语言切换
- **react-i18next**: React 集成包

### 3.2 后端技术栈
**核心框架**:
- **FastAPI**: 高性能异步 Web 框架，自动生成 API 文档
- **Pydantic**: 数据验证和序列化，提供类型安全
- **Uvicorn**: ASGI 服务器，支持高并发

**工作流引擎**:
- **LangGraph**: AI 工作流编排引擎，支持复杂的工作流定义
- **LangChain**: AI 应用开发框架，提供丰富的 AI 工具链
- **Celery**: 分布式任务队列（可选，用于长时间运行的任务）

**数据库和存储**:
- **SQLAlchemy**: ORM 数据库操作，支持多种数据库
- **Alembic**: 数据库迁移工具
- **Redis**: 缓存和会话存储
- **FAISS**: 向量相似性搜索，用于文档检索

**文档处理**:
- **PyPDF2/pdfplumber**: PDF 文档处理
- **python-docx**: Word 文档处理
- **pandas**: Excel 和 CSV 数据处理
- **python-magic**: 文件类型检测

**实时通信**:
- **WebSocket**: 实时双向通信
- **Server-Sent Events**: 服务器推送事件（备用）

### 3.3 AI 服务集成
**语言模型提供商**:
- **OpenAI**: GPT-4、GPT-3.5-turbo 等模型
- **OpenRouter**: 多模型 API 网关，支持多种开源模型
- **Ollama**: 本地模型部署，支持 Llama、Mistral 等模型
- **Anthropic**: Claude 模型（可选）

**嵌入模型**:
- **HuggingFace**: multilingual-e5-small、sentence-transformers
- **OpenAI**: text-embedding-ada-002
- **本地嵌入模型**: 支持本地部署的嵌入模型

**工作流引擎**:
- **LangGraph**: 主要工作流编排引擎
- **LangChain**: AI 应用开发框架
- **自定义工作流**: 支持用户自定义工作流

**模型管理**:
- **模型版本管理**: 支持模型版本切换和回滚
- **模型性能监控**: 监控模型响应时间和准确率
- **模型成本控制**: 监控和限制模型使用成本

### 3.4 部署要求
**容器化**:
- **Docker**: 应用容器化，支持多阶段构建
- **Docker Compose**: 本地开发环境编排
- **Kubernetes**: 生产环境容器编排（可选）

**环境配置**:
- **多环境支持**: 开发、测试、预生产、生产环境
- **环境变量管理**: 使用 .env 文件和环境变量
- **配置中心**: 支持动态配置更新

**数据持久化**:
- **数据库**: SQLite（开发）、PostgreSQL（生产）
- **文件存储**: 本地文件系统或云存储（S3、OSS）
- **备份策略**: 定期数据备份和恢复

**监控和日志**:
- **日志记录**: 结构化日志，支持不同日志级别
- **错误追踪**: Sentry 或类似服务集成
- **性能监控**: APM 工具集成
- **健康检查**: 提供健康检查端点

**安全要求**:
- **HTTPS**: 强制使用 HTTPS 加密传输
- **CORS**: 配置跨域资源共享
- **认证授权**: JWT 或 OAuth 2.0 认证
- **输入验证**: 严格的输入验证和清理

---

**文档版本**: v1.1  
**创建日期**: 2024年12月  
**最后更新**: 2024年12月  
**维护人员**: 开发团队
